<!DOCTYPE html>
<html>
  <head>
    <title>{{ item.title }}</title>
    <style>
      .success-message {
        background-color: #dff0d8;
        color: #3c763d;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #d6e9c6;
      }
    </style>
  </head>
  <body>
    {% with messages = get_flashed_messages(category_filter=["success"]) %}
    {% if messages %}
      <div class="success-message">
        {% for message in messages %}
          {{ message }}
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

    <p>
      You are logged in by username {{ session.username }}. Your personal ID-number is {{ session.get('id') }}.
    </p>
    <h2>SUPERMARKET</h2>
    <h3>{{ item.title }}</h3>
    <p>{{ item.description | e}}</p>
    <p>Price: {{ item.price | e}} â‚¬</p>
    <p>Available: {{ item.quantity }} pcs</p>
    <p>Seller: <a href="/user/{{ item.user_id }}">{{ item.username }}</a></p>
    
    {% if classes %}
    <p>
      Classes:
      <ul>
        {% for class in classes %}
        <li>{{ class.title }}: {{ class.value }}</li>
        {% endfor %}
      </ul>
    </p>
    {% endif %}

    {% if session.get("id") != item.user_id %}
      {% if item.quantity > 0 %}
      <form action="/create_purchase" method="post">
        Pcs:
        <select name="quantity" required>
          <option value="" disabled selected>Select quantity</option>
          {% for i in range(1, [item.quantity, 5]|min + 1) %}
          <option value="{{ i }}">{{ i }}</option>
          {% endfor %}
        </select>
        <input type="hidden" name="item_id" value="{{ item.id }}"/>
        <input type="hidden" name="price" value="{{ item.price }}"/>
        <input type="hidden" name="seller_id" value="{{ item.user_id }}"/>
        <input type="submit" value="Add to basket" />
      </form>
      {% else %}
      <p>This product is currently out of stock.</p>
      {% endif %}
    {% endif %}

    {% if session.get("id") == item.user_id %}
    <p>
      <a href="/edit_item/{{ item.id }}">Edit</a>
      <a href="/remove_item/{{ item.id }}">Delete</a>
    </p>
    {% endif %}

    <p>
      <a href="/">Mainpage</a>
      <a href="/user/{{ session.get('id') }}">Homepage</a>
    </p>
  </body>
</html>